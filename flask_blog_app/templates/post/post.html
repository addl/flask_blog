{% extends 'common/base.html' %}

{% block title %}
{{ super() }} - {{ post.title }}
{% endblock %}

{% block meta_description %}
    <meta name="description" content="{{ post.description }}">
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css" />
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

<script>
    $(document).ready(function() {
        /* Highlight code */
        $('pre').toggleClass('sh_python');
        /* Table Content */
        theUl = $('<ul />');
        $("article h2").each(function(index, elem) {
            /* Set the id*/
            var theId = $(elem).html().replaceAll(' ', '-').toLowerCase()
            $(elem).attr('id', theId);
            theLi = $('<li />');
            theA = $('<a />').html($(elem).html()).attr('href', '#' + theId).appendTo(theLi);
            $(theUl).append(theLi);
        });
        $("#table-content").append(theUl);
        /* Image Viewer */
        const a = new ImgPreviewer('.post-content', {
            scrollbar: true
        })
        /* Markdown comment */
        var sme = new SimpleMDE({status: false, autoDownloadFontAwesome: false, toolbar: false});
        $("#comment-form").on('submit', function(e){
            $("#comment-form #content").val((sme.markdown(sme.value())));
            comment_text = $("#comment-form #content").val();
            if(comment_text.trim() === ""){
                return;
            }
        });
    });
</script>
{% endblock %}

{% block language %}
    <a>ESP</a>
{% endblock %}

{% block sidebar %}
<aside>
    <div id="table-content">
        <h2 class="title">
            {{ _('Table of Content') }}
        </h2>
    </div>
    <div id="affiliate"></div>
</aside>
{% endblock %}

{% block main_content %}
<article>
    <div class="section-header">
        <h1 class="post-title">
            {{ post.title }}
        </h1>
        <p class="extra-data">
            {{ _('by') }} {{ post.user.email }} | {{ post.timestamp.strftime('%Y-%m-%d') }} |
            {% if g.lang_code == 'en' %}
                <a href="/es/posts/{{ post.translations.es.human_url }}"><span class="fi fi-es fis"></span></a>
            {% endif %}
            {% if g.lang_code == 'es' %}
                <a href="/en/posts/{{ post.translations.en.human_url }}"><span class="fi fi-gb fis"></span></a>
            {% endif %}
        </p>
        <span class="divider" />
    </div>
    <section class="post-content">
        {{ post_md | safe }}
    </section>
    <section class="comments">
        {% if current_user.is_authenticated %}
            <form method="POST" action="{{ url_for('POST_BP.create_comment') }}" id="comment-form">
                {{ form.csrf_token }}
                {{ form.post_id }}
                <div class="comment-header">
                    <img src="{{ current_user.picture }}" width="50" height="50" />
                    <h3>{{ _('Ask me anything') }}</h3>
                </div>
                {{ form.content }}
                <div class="buttons">
                    <a href="https://www.markdownguide.org/basic-syntax/" target="_blank">
                        <i class="fab fa-markdown"></i> Use markdown
                    </a>
                    <button type="submit">{{ _('Comment') }}</button>
                </div>
            </form>
        {% endif %}
        <h2><i class="fa fa-comments" aria-hidden="true"></i> {{ _('Comments') }}</h2>
        <div id="comments">
            {% for comment in post.comments %}
                <div class="comment">
                    <div class="picture">
                        <img src="{{ comment.user.picture }}" width="50" height="50" />
                    </div>
                    <div class="content">
                        <div class="comment-header">
                            <span>{{ comment.user.name }}</span>
                        </div>
                        <p>{{ comment.content | safe }}</p>
                        <div class="actions">
                            <a class="comment-reply">{{ _('Reply') }}</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
</article>
{% endblock %}

